export const h22 = new Float32Array([0.0019000209867954254,0.0018992953700944781,0.0018985697533935308,0.0018978441366925836,0.001897118636406958,0.0018963930197060108,0.0018956674030050635,0.0018949417863041162,0.001894216169603169,0.0018934905529022217,0.0018927649362012744,0.0018920393195003271,0.0018913137027993798,0.0018905882025137544,0.001889862585812807,0.0018891369691118598,0.0018884113524109125,0.0018876857357099652,0.001886960119009018,0.0018862345023080707,0.0018855088856071234,0.001884783268906176,0.0018840577686205506,0.0018833321519196033,0.001882606535218656,0.0018818809185177088,0.0018811553018167615,0.0018804296851158142,0.001879704068414867,0.0018789784517139196,0.0018782529514282942,0.001877527334727347,0.0018768017180263996,0.0018760761013254523,0.001875350484624505,0.0018746248679235578,0.0018738992512226105,0.0018731736345216632,0.001872448017820716,0.0018717225175350904,0.0018709969008341432,0.0018702712841331959,0.0018695456674322486,0.0018687740666791797,0.0018678851192817092,0.0018669961718842387,0.0018661072244867682,0.0018652182770892978,0.0018643293296918273,0.0018634403822943568,0.0018625514348968863,0.0018616624874994159,0.0018607735401019454,0.001859884592704475,0.0018589956453070045,0.001858106697909534,0.0018572177505120635,0.001856328803114593,0.0018554398557171226,0.001854550908319652,0.0018536619609221816,0.0018527730135247111,0.0018518840661272407,0.0018509951187297702,0.0018501061713322997,0.0018492172239348292,0.0018483282765373588,0.0018474393291398883,0.0018465503817424178,0.0018456614343449473,0.0018447724869474769,0.0018438835395500064,0.001842994592152536,0.0018421056447550654,0.001841216697357595,0.0018403277499601245,0.001839438802562654,0.0018385498551651835,0.001837660907767713,0.0018367719603702426,0.0018358830129727721,0.0018349940655753016,0.0018341051181778312,0.0018332161707803607,0.0018323271069675684,0.001831438159570098,0.0018305148696526885,0.0018294659676030278,0.0018284169491380453,0.0018273680470883846,0.001826319145038724,0.0018252701265737414,0.0018242212245240808,0.00182317232247442,0.0018221233040094376,0.0018210744019597769,0.0018200254999101162,0.0018189764814451337,0.001817927579395473,0.0018168785609304905,0.0018158296588808298,0.0018147807568311691,0.0018137317383661866,0.001812682836316526,0.0018116339342668653,0.0018105849158018827,0.001809536013752222,0.0018084871117025614,0.0018074380932375789,0.0018063891911879182,0.0018053401727229357,0.001804291270673275,0.0018032423686236143,0.0018021933501586318,0.0018011444481089711,0.0018000955460593104,0.001799046527594328,0.0017979976255446672,0.0017969487234950066,0.001795899705030024,0.0017948508029803634,0.0017938017845153809,0.0017927528824657202,0.0017917039804160595,0.001790654961951077,0.0017896060599014163,0.0017885571578517556,0.0017875081393867731,0.0017864592373371124,0.0017853871686384082,0.0017841821536421776,0.001782977138645947,0.0017817721236497164,0.0017805671086534858,0.0017793620936572552,0.0017781570786610246,0.0017769521800801158,0.0017757471650838852,0.0017745421500876546,0.001773337135091424,0.0017721321200951934,0.0017709271050989628,0.0017697220901027322,0.0017685171915218234,0.0017673121765255928,0.0017661071615293622,0.0017649021465331316,0.001763697131536901,0.0017624921165406704,0.0017612871015444398,0.001760082202963531,0.0017588771879673004,0.0017576721729710698,0.0017564671579748392,0.0017552621429786086,0.001754057127982378,0.0017528522294014692,0.0017516472144052386,0.001750442199409008,0.0017492371844127774,0.0017480321694165468,0.0017468271544203162,0.0017456221394240856,0.0017444172408431768,0.0017432122258469462,0.0017420072108507156,0.001740802195854485,0.0017395971808582544,0.0017383921658620238,0.0017371871508657932,0.0017359822522848845,0.0017347772372886539,0.0017335597658529878,0.0017322032945230603,0.0017308468231931329,0.0017294902354478836,0.0017281337641179562,0.0017267772927880287,0.0017254207050427794,0.001724064233712852,0.0017227077623829246,0.0017213511746376753,0.0017199947033077478,0.0017186382319778204,0.0017172816442325711,0.0017159251729026437,0.0017145687015727162,0.0017132122302427888,0.0017118556424975395,0.001710499171167612,0.0017091426998376846,0.0017077861120924354,0.001706429640762508,0.0017050731694325805,0.0017037165816873312,0.0017023601103574038,0.0017010036390274763,0.001699647051282227,0.0016982905799522996,0.0016969341086223722,0.0016955776372924447,0.0016942210495471954,0.001692864578217268,0.0016915081068873405,0.0016901515191420913,0.0016887950478121638,0.0016874385764822364,0.0016860819887369871,0.0016847255174070597,0.0016833690460771322,0.001682012458331883,0.0016806559870019555,0.001679299515672028,0.0016779430443421006,0.0016765864565968513,0.0016752276569604874,0.0016737247351557016,0.001672221813350916,0.0016707188915461302,0.0016692159697413445,0.0016677130479365587,0.001666210126131773,0.0016647072043269873,0.0016632043989375234,0.0016617014771327376,0.001660198555327952,0.0016586956335231662,0.0016571927117183805,0.0016556897899135947,0.001654186868108809,0.0016526839463040233,0.0016511810244992375,0.0016496781026944518,0.001648175180889666,0.0016466722590848804,0.0016451693372800946,0.001643666415475309,0.0016421634936705232,0.0016406605718657374,0.0016391576500609517,0.001637654728256166,0.0016361518064513803,0.0016346488846465945,0.0016331459628418088,0.001631643041037023,0.0016301401192322373,0.0016286371974274516,0.0016271342756226659,0.0016256313538178802,0.0016241284320130944,0.0016226255102083087,0.001621122588403523,0.0016196196665987372,0.0016181167447939515,0.0016166138229891658,0.00161511090118438,0.0016136080957949162,0.0016121051739901304,0.0016106022521853447,0.0016089656855911016,0.0016073220176622272,0.0016056783497333527,0.0016040346818044782,0.0016023910138756037,0.0016007473459467292,0.0015991036780178547,0.0015974600100889802,0.0015958163421601057,0.0015941726742312312,0.0015925290063023567,0.0015908853383734822,0.0015892416704446077,0.0015875980025157332,0.0015859543345868587,0.0015843106666579843,0.0015826669987291098,0.0015810233308002353,0.0015793796628713608,0.0015777359949424863,0.0015760923270136118,0.0015744486590847373,0.0015728049911558628,0.0015711613232269883,0.0015695176552981138,0.0015678739873692393,0.0015662303194403648,0.0015645866515114903,0.0015629429835826159,0.0015612993156537414,0.0015596556477248669,0.0015580119797959924,0.0015563683118671179,0.0015547246439382434,0.001553080976009369,0.0015514373080804944,0.00154979364015162,0.0015481499722227454,0.001546506304293871,0.0015448627527803183,0.0015432190848514438,0.0015415754169225693,0.0015399317489936948,0.001538169221021235,0.0015363909769803286,0.0015346127329394221,0.0015328344888985157,0.001531056361272931,0.0015292781172320247,0.0015274998731911182,0.0015257216291502118,0.0015239433851093054,0.001522165141068399,0.0015203868970274925,0.001518608652986586,0.0015168304089456797,0.0015150521649047732,0.0015132740372791886,0.0015114957932382822,0.0015097175491973758,0.0015079393051564693,0.001506161061115563,0.0015043828170746565,0.00150260457303375,0.0015008263289928436,0.0014990480849519372,0.0014972698409110308,0.0014954917132854462,0.0014937134692445397,0.0014919352252036333,0.0014901569811627269,0.0014883787371218204,0.001486600493080914,0.0014848222490400076,0.0014830440049991012,0.0014812657609581947,0.0014794875169172883,0.0014777093892917037,0.0014759311452507973,0.0014741529012098908,0.0014723746571689844,0.001470596413128078,0.0014688181690871716,0.0014670399250462651,0.0014652616810053587,0.0014634834369644523,0.001461600884795189,0.0014596947003155947,0.0014577886322513223,0.0014558825641870499,0.0014539763797074556,0.0014520703116431832,0.0014501642435789108,0.0014482580590993166,0.0014463519910350442,0.0014444459229707718,0.0014425398549064994,0.0014406336704269052,0.0014387276023626328,0.0014368215342983603,0.0014349153498187661,0.0014330092817544937,0.0014311032136902213,0.001429197029210627,0.0014272909611463547,0.0014253848930820823,0.001423478708602488,0.0014215726405382156,0.0014196665724739432,0.001417760387994349,0.0014158543199300766,0.0014139482518658042,0.00141204206738621,0.0014101359993219376,0.0014082299312576652,0.001406323746778071,0.0014044176787137985,0.0014025116106495261,0.0014006054261699319,0.0013986993581056595,0.001396793290041387,0.0013948872219771147,0.0013929810374975204,0.001391074969433248,0.0013891689013689756,0.0013872627168893814,0.001385356648825109,0.0013834505807608366,0.0013815443962812424,0.0013795477570965886,0.0013775209663435817,0.0013754941755905747,0.0013734673848375678,0.0013714405940845609,0.001369413803331554,0.001367387012578547,0.00136536022182554,0.0013633334310725331,0.0013613066403195262,0.0013592798495665193,0.0013572529423981905,0.0013552261516451836,0.0013531993608921766,0.0013511725701391697,0.0013491457793861628,0.0013471189886331558,0.0013450921978801489,0.001343065407127142,0.001341038616374135,0.001339011825621128,0.0013369850348681211,0.0013349581276997924,0.0013329313369467854,0.0013309045461937785,0.0013288777554407716,0.0013268509646877646,0.0013248241739347577,0.0013227973831817508,0.0013207705924287438,0.001318743801675737,0.00131671701092273,0.001314690220169723,0.0013126633130013943,0.0013106365222483873,0.0013086097314953804,0.0013065829407423735,0.0013045561499893665,0.0013025293592363596,0.0013005025684833527,0.0012984757777303457,0.0012964489869773388,0.0012944221962243319,0.0012923181056976318,0.0012901781592518091,0.0012880383292213082,0.0012858983827754855,0.0012837585527449846,0.0012816187227144837,0.001279478776268661,0.0012773389462381601,0.0012751991162076592,0.0012730591697618365,0.0012709193397313356,0.001268779393285513,0.001266639563255012,0.0012644997332245111,0.0012623597867786884,0.0012602199567481875,0.0012580800103023648,0.001255940180271864,0.001253800350241363,0.0012516604037955403,0.0012495205737650394,0.0012473807437345386,0.0012452407972887158,0.001243100967258215,0.0012409610208123922,0.0012388211907818913,0.0012366813607513905,0.0012345414143055677,0.0012324015842750669,0.001230261754244566,0.0012281218077987432,0.0012259819777682424,0.0012238420313224196,0.0012217022012919188,0.0012195623712614179,0.0012174224248155951,0.0012152825947850943,0.0012131427647545934,0.0012110028183087707,0.0012088629882782698,0.001206723041832447,0.0012045832118019462,0.0012024433817714453,0.001200238591991365,0.0011979937553405762,0.0011957489186897874,0.0011935039656236768,0.001191259128972888,0.0011890141759067774,0.0011867693392559886,0.001184524386189878,0.0011822795495390892,0.0011800347128883004,0.0011777897598221898,0.001175544923171401,0.0011732999701052904,0.0011710551334545016,0.001168810180388391,0.0011665653437376022,0.0011643205070868134,0.0011620755540207028,0.001159830717369914,0.0011575857643038034,0.0011553409276530147,0.001153095974586904,0.0011508511379361153,0.0011486063012853265,0.0011463613482192159,0.001144116511568427,0.0011418715585023165,0.0011396267218515277,0.001137381768785417,0.0011351369321346283,0.0011328920954838395,0.001130647142417729,0.0011284023057669401,0.0011261573527008295,0.0011239125160500407,0.0011216675629839301,0.0011194227263331413,0.0011171778896823525,0.001114932936616242,0.0011126880999654531,0.0011104431468993425,0.0011081983102485538,0.0011059533571824431,0.0011036553187295794,0.0011013138573616743,0.0010989723959937692,0.001096630934625864,0.0010942894732579589,0.0010919480118900537,0.0010896066669374704,0.0010872652055695653,0.0010849237442016602,0.001082582282833755,0.0010802408214658499,0.0010778993600979447,0.0010755578987300396,0.0010732164373621345,0.0010708749759942293,0.0010685335146263242,0.001066192053258419,0.001063850591890514,0.0010615091305226088,0.0010591676691547036,0.0010568262077867985,0.0010544847464188933,0.0010521432850509882,0.0010498019400984049,0.0010474604787304997,0.0010451190173625946,0.0010427775559946895,0.0010404360946267843,0.0010380946332588792,0.001035753171890974,0.001033411710523069,0.0010310702491551638,0.0010287287877872586,0.0010263873264193535,0.0010240458650514483,0.0010217044036835432,0.001019362942315638,0.001017021480947733,0.0010146800195798278,0.0010123386746272445,0.0010099972132593393,0.0010076557518914342,0.001005314290523529,0.001002930337563157,0.0010005010990425944,0.0009980718605220318,0.0009956426220014691,0.0009932134998962283,0.0009907842613756657,0.000988355022855103,0.0009859257843345404,0.0009834966622292995,0.000981067423708737,0.0009786381851881742,0.0009762090048752725,0.0009737797663547099,0.0009713505860418081,0.0009689213475212455,0.0009664921672083437,0.0009640629286877811,0.0009616337483748794,0.0009592045098543167,0.000956775329541415,0.0009543460910208523,0.0009519169107079506,0.0009494876721873879,0.0009470584918744862,0.0009446292533539236,0.0009422000730410218,0.0009397708345204592,0.0009373416542075574,0.0009349124156869948,0.0009324832353740931,0.0009300539968535304,0.0009276248165406287,0.000925195578020066,0.0009227663977071643,0.0009203371591866016,0.0009179079788736999,0.0009154787403531373,0.0009130495600402355,0.0009106203215196729,0.0009081911412067711,0.0009057619026862085,0.0009033327223733068,0.0009009034838527441,0.0008984414162114263,0.0008959335973486304,0.0008934257784858346,0.0008909179596230388,0.0008884101407602429,0.0008859023218974471,0.0008833945030346513,0.0008808866841718554,0.0008783788653090596,0.0008758710464462638,0.000873363227583468,0.0008708554087206721,0.0008683475898578763,0.0008658398292027414,0.0008633320103399456,0.0008608241914771497,0.0008583163726143539,0.0008558085537515581,0.0008533007348887622,0.0008507929160259664,0.0008482850971631706,0.0008457772783003747,0.0008432694594375789,0.0008407616405747831,0.0008382538217119873,0.0008357460028491914,0.0008332381839863956,0.0008307303651235998,0.0008282225462608039,0.0008257147273980081,0.0008232069085352123,0.0008206990896724164,0.0008181912708096206,0.0008156834519468248,0.000813175633084029,0.0008106678142212331,0.0008081599953584373,0.0008056521764956415,0.0008031443576328456,0.0008006365387700498,0.000798128719907254,0.0007956209010444582,0.0007931130821816623,0.0007905809325166047,0.0007880039629526436,0.0007854269933886826,0.0007828499656170607,0.0007802729960530996,0.0007776960264891386,0.0007751189987175167,0.0007725420291535556,0.0007699650595895946,0.0007673880318179727,0.0007648110622540116,0.0007622340926900506,0.0007596570649184287,0.0007570800953544676,0.0007545031257905066,0.0007519260980188847,0.0007493491284549236,0.0007467721588909626,0.0007441951311193407,0.0007416181615553796,0.0007390411337837577,0.0007364641642197967,0.0007338871946558356,0.0007313101668842137,0.0007287331973202527,0.0007261562277562916,0.0007235791999846697,0.0007210022304207087,0.0007184252608567476,0.0007158482330851257,0.0007132712635211647,0.0007106942939572036,0.0007081172661855817,0.0007055402966216207,0.0007029633270576596,0.0007003862992860377,0.0006978093297220767,0.0006952323601581156,0.0006926553323864937,0.0006900783628225327,0.0006875013350509107,0.0006849243654869497,0.0006823473959229887,0.0006797534297220409,0.0006771169719286263,0.0006744805141352117,0.0006718440563417971,0.0006692075985483825,0.0006665711407549679,0.0006639346829615533,0.0006612982251681387,0.0006586617091670632,0.0006560252513736486,0.000653388793580234,0.0006507523357868195,0.0006481158779934049,0.0006454794201999903,0.0006428429624065757,0.0006402065046131611,0.0006375700468197465,0.0006349335890263319,0.0006322971312329173,0.0006296606734395027,0.0006270242156460881,0.0006243877578526735,0.000621751241851598,0.0006191147840581834,0.0006164783262647688,0.0006138418684713542,0.0006112054106779397,0.0006085689528845251,0.0006059324950911105,0.0006032960372976959,0.0006006595795042813,0.0005980231217108667,0.0005953866639174521,0.0005927502061240375,0.0005901137483306229,0.0005874772323295474,0.0005848407745361328,0.0005822043167427182,0.0005795678589493036,0.000576931401155889,0.0005742949433624744,0.0005716584855690598,0.0005690220277756453,0.0005663747433573008,0.0005636886926367879,0.0005610027001239359,0.000558316707611084,0.0005556306568905711,0.0005529446643777192,0.0005502586718648672,0.0005475726211443543,0.0005448866286315024,0.0005422005779109895,0.0005395145853981376,0.0005368285928852856,0.0005341425421647727,0.0005314565496519208,0.0005287705571390688,0.000526084506418556,0.000523398513905704,0.0005207125213928521,0.0005180264706723392,0.0005153404781594872,0.0005126544856466353,0.0005099684349261224,0.0005072824424132705,0.0005045964499004185,0.0005019103991799057,0.0004992244066670537,0.0004965383559465408,0.0004938523634336889,0.0004911663709208369,0.0004884803202003241,0.0004857943276874721,0.0004831083060707897,0.00048042231355793774,0.00047773629194125533,0.0004750502703245729,0.00047236427781172097,0.00046967825619503856,0.00046699223457835615,0.0004643062420655042,0.0004616202204488218,0.00045893419883213937,0.00045624817721545696,0.000453562184702605,0.0004508701676968485,0.00044814471038989723,0.00044541925308294594,0.00044269379577599466,0.0004399683384690434,0.00043724291026592255,0.00043451745295897126,0.00043179199565202,0.0004290665383450687,0.0004263410810381174,0.0004236156528349966,0.0004208901955280453,0.000418164738221094,0.00041543928091414273,0.00041271382360719144,0.0004099883954040706,0.00040726293809711933,0.00040453748079016805,0.00040181202348321676,0.0003990865661762655,0.00039636113797314465,0.00039363568066619337,0.0003909102233592421,0.0003881847660522908,0.0003854593087453395,0.0003827338805422187,0.0003800084232352674,0.0003772829659283161,0.00037455750862136483,0.00037183205131441355,0.0003691066231112927,0.00036638116580434144,0.00036365570849739015,0.00036093025119043887,0.0003582047938834876,0.00035547936568036675,0.00035275390837341547,0.0003500284510664642,0.0003473029937595129,0.0003445775364525616,0.0003418521082494408,0.0003391266509424895,0.0003364011936355382,0.00033367323339916766,0.00033091858495026827,0.00032816396560519934,0.00032540931715629995,0.000322654697811231,0.00031990004936233163,0.0003171454300172627,0.0003143907815683633,0.0003116361622232944,0.000308881513774395,0.00030612689442932606,0.00030337224598042667,0.00030061762663535774,0.00029786297818645835,0.00029510832973755896,0.00029235371039249003,0.00028959906194359064,0.0002868444425985217,0.0002840897941496223,0.0002813351748045534,0.000278580526355654,0.00027582590701058507,0.0002730712585616857,0.00027031663921661675,0.00026756199076771736,0.00026480737142264843,0.00026205272297374904,0.00025929807452484965,0.0002565434551797807,0.00025378880673088133,0.0002510341873858124,0.000248279538936913,0.0002455249195918441,0.0002427702711429447,0.00024001563724596053,0.00023726100334897637,0.00023450636945199221,0.00023175173555500805,0.0002289971016580239,0.00022624246776103973,0.00022348783386405557,0.00022073319996707141,0.00021797856607008725,0.00021522355382330716,0.00021245010429993272,0.0002096766693284735,0.00020690321980509907,0.00020412977028172463,0.0002013563207583502,0.00019858287123497576,0.00019580942171160132,0.00019303597218822688,0.00019026252266485244,0.00018748908769339323,0.0001847156381700188,0.00018194218864664435,0.00017916873912326992,0.00017639528959989548,0.00017362184007652104,0.0001708483905531466,0.00016807494102977216,0.00016530150605831295,0.00016252805653493851,0.00015975460701156408,0.00015698115748818964,0.0001542077079648152,0.00015143425844144076,0.00014866080891806632,0.00014588735939469188,0.00014311392442323267,0.00014034047489985824,0.0001375670253764838,0.00013479357585310936,0.00013202012632973492,0.00012924667680636048,0.00012647322728298604,0.0001236997777596116,0.00012092633551219478,0.00011815288598882034,0.00011537944374140352,0.00011260599421802908,0.00010983254469465464,0.0001070590951712802,0.00010428565292386338,0.00010151220340048894,0.0000987387538771145,0.00009596530435374007,0.00009318387310486287,0.0000904020489542745,0.00008762022480368614,0.00008483840792905539,0.00008205658377846703,0.00007927475962787867,0.0000764929354772903,0.00007371111132670194,0.00007092928717611358,0.00006814746302552521,0.00006536563887493685,0.00006258381472434849,0.00005980199057376012,0.00005702016642317176,0.000054238342272583395,0.00005145651812199503,0.00004867469397140667,0.000045892869820818305,0.00004311104930820875,0.000040329225157620385,0.00003754740100703202,0.00003476557685644366,0.000031983752705855295,0.00002920192855526693,0.000026420104404678568,0.00002363828207307961,0.000020856457922491245,0.00001807463377190288,0.000015292809621314518,0.000012510986380220857,0.000009729162229632493,0.000006947338533791481,0.000004165514837950468,0.0000013836910284226178,-0.0000013981327811052324,-0.00000417995670431992,-0.000006961780400160933,-0.000009743604096001945,-0.000012525428246590309,-0.000015307252397178672,-0.000018089074728777632,-0.000020870898879365996,-0.00002365272302995436,-0.000026432689992361702,-0.00002921241866715718,-0.000031992145522963256,-0.000034771874197758734,-0.00003755160287255421,-0.0000403313351853285,-0.00004311106386012398,-0.000045890792534919456,-0.000048670521209714934,-0.00005145024988451041,-0.00005422997855930589,-0.00005700970723410137,-0.00005978943590889685,-0.00006256916094571352,-0.000065348889620509,-0.00006812861829530448,-0.00007090835424605757,-0.00007368808292085305,-0.00007646781159564853,-0.000079247540270444,-0.00008202726894523948,-0.00008480699762003496,-0.00008758672629483044,-0.00009036645496962592,-0.0000931461836444214,-0.00009592591231921688,-0.00009870564099401236,-0.00010148536966880783,-0.00010426509834360331,-0.00010704482701839879,-0.00010982455569319427,-0.00011260428436798975,-0.00011538401304278523,-0.0001181637417175807,-0.00012094347039237618,-0.00012372319179121405,-0.00012650292774196714,-0.000129282649140805,-0.0001320623850915581,-0.0001348421210423112,-0.00013762184244114906,-0.00014040157839190215,-0.00014318129979074,-0.00014595073298551142,-0.0001487178960815072,-0.00015148507372941822,-0.00015425225137732923,-0.00015701941447332501,-0.00015978659212123603,-0.0001625537552172318,-0.00016532093286514282,-0.00016808811051305383,-0.00017085527360904962,-0.00017362245125696063,-0.00017638961435295641,-0.00017915679200086743,-0.00018192396964877844,-0.00018469113274477422,-0.00018745831039268523,-0.00019022547348868102,-0.00019299265113659203,-0.00019575982878450304,-0.00019852699188049883,-0.00020129416952840984,-0.00020406134717632085,-0.00020682851027231663,-0.00020959568792022765,-0.00021236285101622343,-0.00021513002866413444,-0.00021789720631204545,-0.00022066436940804124,-0.00022343154705595225,-0.00022619871015194803,-0.00022896588779985905,-0.00023173306544777006,-0.00023450022854376584]);
import { MidiClip } from "../clips/MidiClip";
import { EffectPlugin } from "../effects/effect_interface";
import { UseList_Heap } from "../performance/allocators/free_list";
import { AOPluginType, AudioOutputPlugin } from "./plugin_interface";

export class Plugin2H implements AudioOutputPlugin {
    wantsMic: boolean;
    pluginName: string;
    type: AOPluginType;
    effects: EffectPlugin[];
    parameters: Record<string, any>;

    //user defined
    object_allocator: UseList_Heap;
    objects: Record<string, Uint8Array & { ptr: number }>;
    midiClips: MidiClip[];

    constructor() {
        this.wantsMic = false;
        this.pluginName = "2hp";
        this.type = AOPluginType.JS;
        this.effects = [];
        this.object_allocator = new UseList_Heap(1024 * 1024 * 12); //12 mb mem
        this.objects = {};
        this.parameters = {};
        this.midiClips = [];
    }

    createObject(name: string, bytes: number): Uint8Array & { ptr: number } {
        const region = this.object_allocator.malloc(bytes);
        this.objects[name] = region;
        return region
    }

    /**
     * 
     * @param name the regions name
     * @param u8a  u8a must be the same length as the original buf
     */
    setObject(name: string, u8a: Uint8Array) {
        this.objects[name].set(u8a, 0)
    }

    accessObject(name: string) {
        return this.objects[name]
    }

    freeObject(name: string) {
        this.object_allocator.free(this.objects[name])
        return delete this.objects[name]
    }

    /**
     * Fill arr with 128 samples starting at the given absolute sample index
     */
    _process128(arr: Float32Array, startSample: number): void {
        const len = h22.length;
        for (let i = 0; i < 128; i++) {
            arr[i] = h22[(startSample + i) % len];
        }
    }

    process128(arr: Float32Array, startSample: number): void {
        this._process128(arr, startSample);
        for (let i = 0; i < this.effects.length; i++) {
            this.effects[i].process128(arr, startSample);
        }
    }
    addEffect(e: EffectPlugin): void {
        e.instance = crypto.randomUUID();
        this.effects.push(e);
    }
    removeEffect(e: EffectPlugin): void {
        this.effects = this.effects.filter(ef => ef.instance != e.instance)
    }

    enableEffect(e: EffectPlugin): void {
        const te = this.effects.find(ef => ef.instance == e.instance);
        if (!te) throw new Error("effect not found");
        te.active = true;
    }

    disableEffect(e: EffectPlugin): void {
        const te = this.effects.find(ef => ef.instance == e.instance);
        if (!te) throw new Error("effect not found");
        te.active = false;
    }

    setParameter(p: string, v: any): void {
        this.parameters[p] = v;
    }
}
